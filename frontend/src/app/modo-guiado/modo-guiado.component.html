<app-header></app-header>

<div class="container">
  <div class="content">
    <div class="layout">
      <div class="image-container" id="avatar-element" [ngClass]="{ 'half-width': showWebcam }">
        <app-canvas [animationUrls]="currentAnimationUrls"></app-canvas>

        <!-- BARRA DE HERRAMIENTAS (radio-buttons) => solo se muestra si hay palabras -->
        <div 
          class="radio-input" 
          [class.open]="toolMenuOpen" 
          (change)="onRadioChange($event)"
          *ngIf="words && words.length > 0 && !showWelcome"
        >
          <!-- Play -->
          <label class="label label-play">
            <input type="radio" id="play" name="value-radio" value="play" />
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path d="M96 52v408l320-204-320-204z" />
            </svg>
          </label>

          <!-- Toggle de “bucle”/”stop” -->
          <label class="label label-play2">
            <input
              type="checkbox"
              id="toggleLoop"
              (change)="onToggleLoop($event)"
            />

            <!-- Icono bucle cuando NO estamos en loop -->
            <img
              *ngIf="!isLooping"
              class="icon-play2"
              src="assets/play-bucle.svg"
              alt="Play2"
            />

            <!-- Icono STOP cuando SÍ estamos en loop -->
            <svg
              *ngIf="isLooping"
              class="icon-stop"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
              width="38"
              height="38"
            >
              <path d="M64 64h384v384H64z" />
            </svg>
          </label>

          <!-- Webcam -->
          <label class="label label-webcam">
            <input type="radio" id="webcam" name="value-radio" value="webcam" />
            <img class="icon-webcam" src="assets/webcam.svg" alt="Webcam" />
          </label>

          <!-- Veloc -->
          <label class="label">
            <input type="radio" id="veloc" name="value-radio" value="veloc" />
            <span class="text">Veloc</span>
          </label>
        </div>
        <!-- Fin barra de herramientas -->


        <!-- Botones que solo se mostrarán cuando la cámara esté activa -->
        <div class="buttons-container" *ngIf="showWebcam">
          <!-- Botón para la palabra -->
          <div
            *ngIf="modo === 'guiado'"
            class="current-word"
          [ngClass]="{ 'small-word': showWebcam }"
            (click)="handleWordClick()"
          >
            <p>{{ currentWord }}</p>
          </div>

        <!-- Botón para desactivar la webcam -->
        <!-- <button (click)="toggleWebcam()" class="small-disable-webcam-btn">
          Desactivar Webcam
        </button> -->
      </div>
    </div>

      <div class="camera-container" *ngIf="showWebcam">
        <video #videoElement class="mirror-video" autoplay></video>
      </div>

      <div class="button-grid" *ngIf="!showWebcam">
        <div class="icon-menu-fixed">
          <button (click)="toggleWebcam()" class="small-webcam-btn">
            Pruébate
          </button>

          <a (click)="volverAModos()" title="Modos">
            <i class="fa-solid fa-home"></i>
          </a>

          <a (click)="navigateTo('perfil')" title="Mi Perfil">
            <i class="fa-solid fa-user"></i>
          </a>
          <a (click)="logout()" title="Cerrar Sesión">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>

        <div class="modo-guiado" id="modo-guiado-container">
          <app-card
            [showWelcome]="showWelcome"
            [levelNumber]="nivelActual"
            [unlockedLevel]="maxUnlockedLevel"
            (continueClicked)="continuar()"
            (startOverClicked)="empezarDesdePrimera()"
            [word]="currentWord"
            [explanation]="currentExplanation"
            (wordClick)="handleWordClick()"
            (repeatClick)="handleRepeatClick()"
            (prevClick)="prevWord()"
            [nextLabel]="isLastWord() ? 'Finalizar nivel' : 'Siguiente'"
            (nextClick)="isLastWord() ? advanceLevel() : nextWord()"
            (chooseLevelClicked)="openChooseLevel()"
            [availableLevels]="availableLevels"
            [showChooseLevel]="showChooseLevel"
            (levelSelected)="onLevelSelected($event)"
          >
          </app-card>
        </div>
      </div>
    </div>
  </div>
</div>
