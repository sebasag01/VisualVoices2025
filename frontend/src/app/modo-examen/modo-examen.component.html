<app-header></app-header>

<div class="container">
  <div class="content">
    <div class="layout">
      
      <!-- Contenedor del avatar (3D) a la izquierda -->
      <div class="image-container" id="avatar-element" [ngClass]="{'libre-half-width': showWebcam}">
        <!-- Canvas con la animaciÃ³n -->
        <app-canvas [animationUrls]="animaciones"></app-canvas>

        <!-- MenÃº de herramientas (Radio Buttons) -->
        <div class="radio-input open" (change)="onRadioChange($event)">
          <!-- Play -->
          <label class="label label-play" [class.selected]="selectedTool === 'play'">
            <input type="radio" id="play" name="value-radio" value="play" />
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path d="M96 52v408l320-204-320-204z" />
            </svg>
          </label>

          <!-- Toggle de â€œbucleâ€/â€stopâ€ -->
<label class="label label-play2">
  <input
    type="checkbox"
    id="toggleLoop"
    (change)="onToggleLoop($event)"
  />

  <!-- Icono bucle cuando NO estamos en loop -->
  <img
    *ngIf="!isLooping"
    class="icon-play2"
    src="assets/play-bucle.svg"
    alt="Play2"
  />

  <!-- Icono STOP cuando SÃ estamos en loop -->
  <svg
    *ngIf="isLooping"
    class="icon-stop"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 512 512"
    width="38"
    height="38"
  >
    <path d="M64 64h384v384H64z" />
  </svg>
</label>


          <!-- Webcam -->
<label class="label label-webcam">
  <input
    type="checkbox"
    id="toggleWebcam"
    [checked]="showWebcam"
    (change)="toggleWebcam()"
  />
  <img class="icon-webcam" src="assets/webcam.svg" alt="Webcam" />
</label>


          <!-- Velocidad (Speed) -->
          <label class="label">
            <input type="radio" id="veloc" name="value-radio" value="veloc" />
            <span class="text">Veloc</span>
          </label>
        </div>
      </div> 
      
      <!-- Contenedor de la cÃ¡mara, se muestra solo si showWebcam es true -->
      <div class="camera-container" *ngIf="showWebcam">
        <video #videoElement class="mirror-video" autoplay></video>
      </div>

      <!-- Panel derecho con las opciones de examen -->
      <div class="right-panel" *ngIf="!showWebcam">
        
        <!-- Iconos de perfil, ajustes, logout -->
        <div class="icon-menu-fixed">
          <a (click)="volverAModos()" title="Modos">
            <i class="fa-solid fa-home"></i>
          </a>
          <a (click)="navigateTo('perfil')" title="Mi Perfil" class="user-icon">
            <i class="fa-solid fa-user"></i>
          </a>
          
          <a (click)="logout()" title="Cerrar SesiÃ³n" class="logout-icon">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>

        <div *ngIf="!examFinished">
          <!-- TÃ­tulo del modo examen -->
          <h2 class="exam-title">
            <i class="fa-solid fa-bolt" style="margin-right: 10px;"></i>
            Â¡PONTE A PRUEBA!
          </h2>
          <!-- Nuevo enunciado general debajo del tÃ­tulo -->
          <p class="enunciado-general">Â¿QuÃ© ha dicho el avatar?</p>
          
          <!-- Mensaje de carga (se mantiene en esta posiciÃ³n) -->
          <div *ngIf="cargandoPregunta">Cargando pregunta...</div>

          <!-- Opciones de respuesta (4) -->
          <div class="word-list" *ngIf="opciones && !cargandoPregunta">
            <div 
              class="word-item" 
              *ngFor="let opcion of opciones" 
              (click)="seleccionarOpcion(opcion._id)"
              [ngClass]="{
                'correct-answer': optionStatus[opcion._id] === 'correct',
                'wrong-answer': optionStatus[opcion._id] === 'incorrect',
                'correct-solution': respuestaCorrectaId === opcion._id
              }">
              {{ opcion.palabra }}
              <i *ngIf="respuestaCorrectaId === opcion._id" 
                  class="fa-solid fa-check" 
                  style="margin-left: 8px; color: #4caf50;"></i>
            </div>
          </div>

          <!-- BotÃ³n manual: solo aparece tras responder la pregunta -->
          <div *ngIf="answeredThisQuestion && questionCount < maxQuestions" class="text-center mt-4">
            <button class="small-webcam-btn" (click)="cargarNuevaPregunta()">
              Siguiente pregunta
            </button>
          </div>
          
          <!-- Mostrar resultados si ya contestaste la Ãºltima -->
          <div *ngIf="answeredThisQuestion && readyToShowResults" class="text-center mt-4">
            <button class="small-webcam-btn" (click)="mostrarResultados()">
              ğŸ‰ Mostrar resultados
            </button>
          </div>

          <!-- Bloque de feedback: se muestra debajo del botÃ³n de "Nueva Pregunta" -->
          <div *ngIf="resultado" class="resultado" 
              [ngClass]="{'resultado-correcto': resultado==='Â¡Respuesta correcta!', 'resultado-incorrecto': resultado==='Respuesta incorrecta'}">
            <p>
              <i *ngIf="resultado==='Â¡Respuesta correcta!'" class="fa-solid fa-circle-check icon-correct"></i>
              <i *ngIf="resultado==='Respuesta incorrecta'" class="fa-solid fa-circle-xmark icon-incorrect"></i>
              {{ resultado }}
            </p>
          </div>
      </div>

      <div *ngIf="examFinished" class="exam-summary">
        <h3>ğŸ† Â¡Examen completado!</h3>
        <p>Has respondido {{ maxQuestions }} preguntas:</p>
      
        <!-- LÃ­nea de iconos: verde para acierto, rojo para fallo -->
        <div class="summary-icons">
          <ng-container *ngFor="let ok of resultsHistory; let i = index">
            <i 
              class="fa" 
              [ngClass]="ok ? 'fa-check-circle icon-correct' : 'fa-times-circle icon-incorrect'"
            ></i>
          </ng-container>
        </div>
      
        <p class="mt-3">
          <strong>Aciertos:</strong> {{ correctCount }}  
          &nbsp;|&nbsp; 
          <strong>Fallos:</strong> {{ incorrectCount }}
        </p>
      
        <div class="mt-4">
          <button class="small-webcam-btn" (click)="startExamSession()">
            ğŸ”„ Volver a empezar
          </button>
          <button class="small-webcam-btn" (click)="volverAModos()">
            ğŸ  Salir
          </button>
        </div>
      </div>

      </div><!-- fin right-panel -->

    </div><!-- fin layout -->
  </div><!-- fin content -->
</div><!-- fin container -->
