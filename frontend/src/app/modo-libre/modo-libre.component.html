<app-header></app-header>

<div class="container">
  <div class="content">
    <div class="layout">
      <!-- Contenedor del avatar a la izquierda -->
      <div
        class="image-container"
        id="avatar-element"
        [ngClass]="{ 'libre-half-width': showWebcam }"
      >
        <!-- Mostrar palabra seleccionada SOLO cuando la c√°mara est√° activada -->
        <div class="selected-word-container" *ngIf="showWebcam && selectedWord">
          {{ selectedWord.palabra }}
        </div>
        <app-canvas [animationUrls]="currentAnimationUrls"></app-canvas>
        <!-- Men√∫ de herramientas (ahora en el lado izquierdo) -->
        <!-- tools-menu -->

        <!-- NUEVA ESTRUCTURA RADIO-BUTTONS -->
        <div
          class="radio-input"
          [class.open]="toolMenuOpen"
          (change)="onRadioChange($event)"
        >
          <!-- Play -->
          <label class="label label-play">
            <input type="radio" id="play" name="value-radio" value="play" />
            <svg
              class="icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
            >
              <path d="M96 52v408l320-204-320-204z" />
            </svg>
          </label>

          <!-- Radio principal PLAY2, con position: relative -->
          <!-- Sustituyendo el label-play2 antiguo por un toggle de checkbox -->
          <label class="label label-play2">
            <!-- Quitar name="value-radio" porque ya no es un radio group -->
            <input
              type="checkbox"
              id="toggleLoop"
              (change)="onToggleLoop($event)"
            />

            <!-- Mostrar icono de ‚Äúbucle‚Äù cuando NO estamos en loop -->
            <img
              *ngIf="!isLooping"
              class="icon-play2"
              src="assets/play-bucle.svg"
              alt="Play2"
            />

            <!-- Mostrar icono STOP cuando S√ç estamos en loop -->
            <svg
              *ngIf="isLooping"
              class="icon-stop"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
              width="38"
              height="38"
            >
              <path d="M64 64h384v384H64z" />
            </svg>
          </label>

          <!-- Webcam, aqu√≠ conservamos la funcionalidad de togglear la c√°mara -->
          <!-- Radio para la webcam -->
          <label class="label label-webcam">
            <input type="radio" id="webcam" name="value-radio" value="webcam" />

            <!-- Tu imagen ‚Äúwebcam.svg‚Äù desde /public => ruta "/webcam.svg" -->
            <img class="icon-webcam" src="assets/webcam.svg" alt="Webcam" />
          </label>

          <!-- Velocidad (Speed) -->
          <label class="label">
            <input type="radio" id="veloc" name="value-radio" value="veloc" />
            <span class="text">Veloc</span>
          </label>
        </div>
      </div>

      <!-- Contenedor de la c√°mara, se muestra solo cuando showWebcam es true -->
      <div class="camera-container" *ngIf="showWebcam">
        <video #videoElement class="mirror-video" autoplay></video>
        <!-- <button (click)="toggleWebcam()" class="small-disable-webcam-btn">
          Desactivar Webcam
        </button> -->
      </div>

      <!-- Panel derecho (contenido original) se muestra solo cuando la c√°mara est√° desactivada -->
      <div class="right-panel" *ngIf="!showWebcam">
        <!-- Aqu√≠ va tu contenido habitual del panel derecho -->
        <div class="icon-menu-fixed">
          <a (click)="volverAModos()" title="Modos">
            <i class="fa-solid fa-home"></i>
          </a>

          <a (click)="navigateTo('perfil')" title="Mi Perfil">
            <i class="fa-solid fa-user"></i>
          </a>
          <a (click)="logout()" title="Cerrar Sesi√≥n">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>

        <div class="search-wrapper" (click)="toggleDropdown($event)">
          <div class="search-bar">
            <input
              type="text"
              placeholder="Busca cualquier palabra o categor√≠a"
              id="search-input"
              [(ngModel)]="searchText"
              (input)="onSearchInput()"
              (focus)="onInputFocus()"
            />
            <span class="search-icon">üîç</span>
          </div>
        
          <!-- Selector desplegable -->
          <div
            class="multi-select-dropdown"
            [class.open]="isOpen"
            (click)="$event.stopPropagation()"
          >
            <div class="dropdown-content">
              <label
                class="dropdown-item"
                *ngFor="let cat of filteredCategoriesBySearch"
              >
                <input
                  type="checkbox"
                  [value]="cat._id"
                  (change)="onCheckboxChange($event, cat)"
                  [checked]="selectedCategoryIds.includes(cat._id)"
                />
                {{ cat.nombre }}
              </label>
            </div>
          </div>
        </div>
        
      

        <!-- LISTA DE CATEGOR√çAS (vista 1) -->
<div class="category-grid" *ngIf="!selectedCategory">
  <div
    class="card"
    *ngFor="let cat of filteredCategoriesBySearch"
    (click)="onCategoryClick(cat)"
  >
    <div class="card-details">
      <p class="text-title">{{ cat.nombre }}</p>
      <p class="text-body">{{ getPrimerasPalabras(cat) }}</p>
    </div>
    <button class="card-button">M√°s info</button>
  </div>
</div>
        <div
          class="search-bar"
          id="search-container"
          (click)="toggleDropdown($event)"
        >
          <input
            type="text"
            placeholder="Busca cualquier palabra o categor√≠a"
            id="search-input"
            [(ngModel)]="searchText"
            (input)="onSearchInput()"
            (focus)="onInputFocus()"
          />
          <button id="search-btn" title="Buscar" (click)="performSearch()">
            <span class="lupa"></span>
          </button>
        </div>
        <div
          class="multi-select-dropdown"
          [class.open]="isOpen"
          (click)="$event.stopPropagation()"
        >
          <div class="dropdown-content">
            <!-- Recorremos las categor√≠as que pasan el filtro de texto -->
            <label
              class="dropdown-item"
              *ngFor="let cat of filteredCategoriesBySearch"
            >
              <input
                type="checkbox"
                [value]="cat._id"
                (change)="onCheckboxChange($event, cat)"
                [checked]="selectedCategoryIds.includes(cat._id)"
              />
              {{ cat.nombre }}
            </label>
          </div>
        </div>

        <!-- LISTA DE CATEGOR√çAS (vista 1) con estilo de Cards -->
        <!-- NUEVA VISTA DE CATEGOR√çAS CON LA CARD DE LIBRO -->
        <div class="category-grid" *ngIf="!selectedCategory">
          <div
            class="book"
            *ngFor="let cat of filteredCategories"
            (click)="onCategoryClick(cat)"
          >
            <!-- Contenedor con las palabras dentro de la categor√≠a -->
            <p class="category-words">{{ getPrimerasPalabras(cat) }}</p>
            
            <!-- Tapa del libro con el nombre de la categor√≠a -->
            <div class="cover">
              <p class="category-name">{{ cat.nombre }}</p>
            </div>
          </div>
        </div>

<!-- LISTA DE PALABRAS (vista 2) -->
<div class="word-list" *ngIf="selectedCategory">
  <div class="title-row">
    <div class="back-button" (click)="volverAListaCategorias()">
      <i class="fa-solid fa-arrow-left"></i>
    </div>
    <h3>{{ selectedCategory.nombre }}</h3>
  </div>

  <div class="word-buttons">
    <div
      class="word-item"
      *ngFor="let palabra of filteredWordsInSelectedCategory"
      (click)="seleccionarPalabra(palabra)"
      [ngClass]="{
        'selected-word': selectedWord?.palabra === palabra.palabra
      }"
    >
      <div class="word-title">{{ palabra.palabra }}</div>
    </div>
  </div>
  
  
</div>

        
      </div>
      <!-- fin right-panel -->
    </div>
    <!-- fin layout -->
  </div>
  <!-- fin content -->
</div>
<!-- fin container -->
