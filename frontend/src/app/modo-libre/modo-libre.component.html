<app-header></app-header>




<div class="container">
  <div class="content">
    <div class="layout">
      <!-- Contenedor del avatar a la izquierda -->
      <div class="image-container" id="avatar-element" [ngClass]="{'libre-half-width': showWebcam}">
        <app-canvas [animationUrls]="currentAnimationUrls"></app-canvas>
      </div>
      
      <!-- Contenedor de la cámara, se muestra solo cuando showWebcam es true -->
      <div class="camera-container libre-full-right" *ngIf="showWebcam">
        <video #videoElement class="mirror-video" autoplay></video>
        <button (click)="toggleWebcam()" class="small-disable-webcam-btn">
          Desactivar Webcam
        </button>
      </div>

      <!-- Panel derecho (contenido original) se muestra solo cuando la cámara está desactivada -->
      <div class="right-panel" *ngIf="!showWebcam">
        <!-- Aquí va tu contenido habitual del panel derecho -->
        <div class="icon-menu-fixed">
          <button (click)="iniciarTutorial()" class="tutorial-btn">Mostrar Tutorial</button>
          <button (click)="toggleWebcam()" class="small-webcam-btn">Pruébate</button>
          
            <button (click)="volverAModos()" class="back-to-modes-button">
              Volver a Modos
            </button>
          
          <a (click)="navigateTo('perfil')" title="Mi Perfil" class="user-icon">
            <i class="fa-solid fa-user"></i>
          </a>
          <a (click)="navigateTo('ajustes')" title="Ajustes">
            <i class="fa-solid fa-gear"></i>
          </a>
          <a (click)="logout()" title="Cerrar Sesión" class="logout-icon">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>

        <!-- Resto del contenido del panel derecho (barra de búsqueda, dropdown, categorías, etc.) -->
        <div class="search-bar" id="search-container">
          <input type="text" placeholder="Busca cualquier palabra o categoría" id="search-input" />
          <button id="search-btn" title="Buscar">
            <span class="lupa"></span>
          </button>
        </div>

        <!-- Dropdown multiselección -->
        <div class="multi-select-dropdown" *ngIf="!selectedCategory" [class.open]="isOpen" (click)="toggleDropdown($event)">
          <!-- Botón de apertura -->
          <button type="button" class="dropdown-button">
            Filtrar Categorías
            <span class="arrow" [class.rotate]="isOpen">&#9662;</span>
          </button>

          <!-- Contenido desplegable -->
          <div class="dropdown-content" (click)="$event.stopPropagation()">
            <!-- Para cada categoría, un checkbox -->
            <label class="dropdown-item" *ngFor="let cat of categorias">
              <input 
                type="checkbox" 
                [value]="cat._id" 
                (change)="onCheckboxChange($event, cat)" 
                [checked]="selectedCategoryIds.includes(cat._id)"
              />
              {{ cat.nombre }}
            </label>
          </div>
        </div>

        <!-- LISTA DE CATEGORÍAS (vista 1) - Usa filteredCategories en lugar de categorias -->
        <div class="category-list" *ngIf="!selectedCategory">
          <div
            class="category-item"
            *ngFor="let cat of filteredCategories"
            (click)="onCategoryClick(cat)"
          >
            <div class="cat-info">
              <div class="cat-title">{{ cat.nombre }}</div>
              <div class="cat-subtitle">
                <!-- Las primeras 2-3 palabras (o las que quieras) -->
                {{ getPrimerasPalabras(cat) }}
              </div>
            </div>
            <div class="cat-arrow">
              <i class="fa-solid fa-chevron-right"></i>
            </div>
          </div>
        </div>

        <!-- LISTA DE PALABRAS (vista 2) -->
        <div class="word-list" *ngIf="selectedCategory">
          <!-- Botón para volver a la lista de categorías -->
          <div class="back-button" (click)="volverAListaCategorias()">
            <i class="fa-solid fa-arrow-left"></i> 
            <span>Volver</span>
          </div>

          <h3>{{ selectedCategory.nombre }}</h3>

          <div
            class="word-item"
            *ngFor="let palabra of palabrasDeCategoriaSeleccionada"
            (click)="seleccionarPalabra(palabra)"
          >
            <!-- Nombre de la palabra -->
            <div class="word-title">{{ palabra.palabra }}</div>
          </div>
        </div>

      </div><!-- fin right-panel -->

    </div><!-- fin layout -->
  </div><!-- fin content -->
</div><!-- fin container -->
