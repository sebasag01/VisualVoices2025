<app-header></app-header>




<div class="container">
  <div class="content">
    <div class="layout">
      <!-- Contenedor del avatar a la izquierda -->
      <div class="image-container" id="avatar-element" [ngClass]="{'libre-half-width': showWebcam}">
        <app-canvas [animationUrls]="currentAnimationUrls"></app-canvas>
         <!-- Menú de herramientas (ahora en el lado izquierdo) -->
  <div class="tools-menu" [class.open]="toolMenuOpen">
    <p class="tools-menu-placeholder">Menú de herramientas</p>
  </div>
</div>


      
      
      <!-- Contenedor de la cámara, se muestra solo cuando showWebcam es true -->
      <div class="camera-container libre-full-right" *ngIf="showWebcam">
        <video #videoElement class="mirror-video" autoplay></video>
        <button (click)="toggleWebcam()" class="small-disable-webcam-btn">
          Desactivar Webcam
        </button>
      </div>

      <!-- Panel derecho (contenido original) se muestra solo cuando la cámara está desactivada -->
      <div class="right-panel" *ngIf="!showWebcam">
        <!-- Aquí va tu contenido habitual del panel derecho -->
        <div class="icon-menu-fixed">
          <button (click)="iniciarTutorial()" class="tutorial-btn">Mostrar Tutorial</button>
          <button (click)="toggleWebcam()" class="small-webcam-btn">Pruébate</button>
          
            <button (click)="volverAModos()" class="back-to-modes-button">
              Volver a Modos
            </button>
          
          <a (click)="navigateTo('perfil')" title="Mi Perfil" class="user-icon">
            <i class="fa-solid fa-user"></i>
          </a>
          <a (click)="navigateTo('ajustes')" title="Ajustes" class="ajustes-icon">
            <i class="fa-solid fa-gear"></i>
          </a>
          <a (click)="logout()" title="Cerrar Sesión" class="logout-icon">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>

        <div class="search-bar" id="search-container" (click)="toggleDropdown($event)">
          <input 
            type="text" 
            placeholder="Busca cualquier palabra o categoría" 
            id="search-input" 
            [(ngModel)]="searchText" 
            (input)="onSearchInput()" 
            (focus)="onInputFocus()" 
          />
          <button id="search-btn" title="Buscar" (click)="performSearch()">
            <span class="lupa"></span>
          </button>
        </div>
        <div class="multi-select-dropdown" [class.open]="isOpen" (click)="$event.stopPropagation()">
          <div class="dropdown-content">
            <!-- Recorremos las categorías que pasan el filtro de texto -->
            <label class="dropdown-item" *ngFor="let cat of filteredCategoriesBySearch">
              <input 
                type="checkbox" 
                [value]="cat._id" 
                (change)="onCheckboxChange($event, cat)" 
                [checked]="selectedCategoryIds.includes(cat._id)" 
              />
              {{ cat.nombre }}
            </label>
          </div>
        </div>

        <!-- LISTA DE CATEGORÍAS (vista 1) con estilo de Cards -->
<div class="category-grid" *ngIf="!selectedCategory">
  <div class="card" *ngFor="let cat of filteredCategories" (click)="onCategoryClick(cat)">
    <div class="card-details">
      <!-- Título de la categoría -->
      <p class="text-title">{{ cat.nombre }}</p>
      <!-- Pequeño texto de ejemplo: primeras palabras -->
      <p class="text-body">{{ getPrimerasPalabras(cat) }}</p>
    </div>
    <!-- Botón dentro de la card -->
    <button class="card-button">
      Más info
    </button>
  </div>
</div>

        <!-- LISTA DE PALABRAS (vista 2) -->
        <!-- LISTA DE PALABRAS (vista 2) -->
<div class="word-list" *ngIf="selectedCategory">
  <!-- Botón para volver a la lista de categorías -->
  <div class="back-button" (click)="volverAListaCategorias()">
    <i class="fa-solid fa-arrow-left"></i> 
    <span>Volver</span>
  </div>

  <h3>{{ selectedCategory.nombre }}</h3>

  <div
    class="word-item"
    *ngFor="let palabra of palabrasDeCategoriaSeleccionada"
    (click)="seleccionarPalabra(palabra)"
    [ngClass]="{'selected-word': selectedWord?.palabra === palabra.palabra}"
  >
    <!-- Nombre de la palabra -->
    <div class="word-title">{{ palabra.palabra }}</div>
  </div>
</div>



      </div><!-- fin right-panel -->

    </div><!-- fin layout -->
  </div><!-- fin content -->
</div><!-- fin container -->
