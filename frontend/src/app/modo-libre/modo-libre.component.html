<app-header></app-header>

<div class="container">
  <div class="content">
    <div class="layout">
      <!-- Contenedor del avatar a la izquierda -->
      <div
        class="image-container"
        id="avatar-element"
        [ngClass]="{ 'libre-half-width': showWebcam }"
      >
        <!-- Mostrar palabra seleccionada SOLO cuando la cámara está activada -->
        <div class="selected-word-container" *ngIf="showWebcam && selectedWord">
          {{ selectedWord.palabra }}
        </div>
        <app-canvas [animationUrls]="currentAnimationUrls"></app-canvas>
        <!-- Menú de herramientas (ahora en el lado izquierdo) -->
        <!-- tools-menu -->

        <!-- NUEVA ESTRUCTURA RADIO-BUTTONS -->
        <div
          class="radio-input"
          [class.open]="toolMenuOpen"
          (change)="onRadioChange($event)"
        >
          <!-- Play -->
          <label class="label label-play">
            <input type="radio" id="play" name="value-radio" value="play" />
            <svg
              class="icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
            >
              <path d="M96 52v408l320-204-320-204z" />
            </svg>
          </label>

          <!-- Radio principal PLAY2, con position: relative -->
          <!-- Sustituyendo el label-play2 antiguo por un toggle de checkbox -->
          <label class="label label-play2">
            <!-- Quitar name="value-radio" porque ya no es un radio group -->
            <input
              type="checkbox"
              id="toggleLoop"
              (change)="onToggleLoop($event)"
            />

            <!-- Mostrar icono de “bucle” cuando NO estamos en loop -->
            <img
              *ngIf="!isLooping"
              class="icon-play2"
              src="assets/play-bucle.svg"
              alt="Play2"
            />

            <!-- Mostrar icono STOP cuando SÍ estamos en loop -->
            <svg
              *ngIf="isLooping"
              class="icon-stop"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
              width="38"
              height="38"
            >
              <path d="M64 64h384v384H64z" />
            </svg>
          </label>

          <!-- Webcam, aquí conservamos la funcionalidad de togglear la cámara -->
          <!-- Radio para la webcam -->
          <label class="label label-webcam">
            <input type="radio" id="webcam" name="value-radio" value="webcam" />

            <!-- Tu imagen “webcam.svg” desde /public => ruta "/webcam.svg" -->
            <img class="icon-webcam" src="assets/webcam.svg" alt="Webcam" />
          </label>

          <!-- Velocidad (Speed) -->
          <label class="label">
            <input type="radio" id="veloc" name="value-radio" value="veloc" />
            <span class="text">Veloc</span>
          </label>
        </div>
      </div>

      <!-- Contenedor de la cámara, se muestra solo cuando showWebcam es true -->
      <div class="camera-container" *ngIf="showWebcam">
        <video #videoElement class="mirror-video" autoplay></video>
        <!-- <button (click)="toggleWebcam()" class="small-disable-webcam-btn">
          Desactivar Webcam
        </button> -->
      </div>

      <!-- Panel derecho (contenido original) se muestra solo cuando la cámara está desactivada -->
      <div class="right-panel" *ngIf="!showWebcam">
        <!-- Aquí va tu contenido habitual del panel derecho -->
        <div class="icon-menu-fixed">
          <a (click)="volverAModos()" title="Modos">
            <i class="fa-solid fa-home"></i>
          </a>

          <a (click)="navigateTo('perfil')" title="Mi Perfil">
            <i class="fa-solid fa-user"></i>
          </a>
          <a (click)="logout()" title="Cerrar Sesión">
            <i class="fa-solid fa-right-from-bracket"></i>
          </a>
        </div>

        <div
          class="search-bar"
          id="search-container"
          (click)="toggleDropdown($event)"
        >
          <input
            type="text"
            placeholder="Busca cualquier palabra o categoría"
            id="search-input"
            [(ngModel)]="searchText"
            (input)="onSearchInput()"
            (focus)="onInputFocus()"
          />
          <button id="search-btn" title="Buscar" (click)="performSearch()">
            <span class="lupa"></span>
          </button>
        </div>
        <div
          class="multi-select-dropdown"
          [class.open]="isOpen"
          (click)="$event.stopPropagation()"
        >
          <div class="dropdown-content">
            <!-- Recorremos las categorías que pasan el filtro de texto -->
            <label
              class="dropdown-item"
              *ngFor="let cat of filteredCategoriesBySearch"
            >
              <input
                type="checkbox"
                [value]="cat._id"
                (change)="onCheckboxChange($event, cat)"
                [checked]="selectedCategoryIds.includes(cat._id)"
              />
              {{ cat.nombre }}
            </label>
          </div>
        </div>

        <!-- LISTA DE CATEGORÍAS (vista 1) con estilo de Cards -->
        <!-- NUEVA VISTA DE CATEGORÍAS CON LA CARD DE LIBRO -->
        <div class="category-grid" *ngIf="!selectedCategory">
          <div
            class="book"
            *ngFor="let cat of filteredCategories"
            (click)="onCategoryClick(cat)"
          >
            <!-- Contenedor con las palabras dentro de la categoría -->
            <p class="category-words">{{ getPrimerasPalabras(cat) }}</p>
            
            <!-- Tapa del libro con el nombre de la categoría -->
            <div class="cover">
              <p class="category-name">{{ cat.nombre }}</p>
            </div>
          </div>
        </div>

        <!-- LISTA DE PALABRAS (vista 2) -->
        <!-- LISTA DE PALABRAS (vista 2) -->
        <div class="word-list" *ngIf="selectedCategory">
          <!-- Botón para volver a la lista de categorías -->
          <div class="back-button" (click)="volverAListaCategorias()">
            <i class="fa-solid fa-arrow-left"></i>
            <span>Volver</span>
          </div>

          <h3>{{ selectedCategory.nombre }}</h3>

          <div
            class="word-item"
            *ngFor="let palabra of palabrasDeCategoriaSeleccionada"
            (click)="seleccionarPalabra(palabra)"
            [ngClass]="{
              'selected-word': selectedWord?.palabra === palabra.palabra
            }"
          >
            <!-- Nombre de la palabra -->
            <div class="word-title">{{ palabra.palabra }}</div>
          </div>
        </div>
      </div>
      <!-- fin right-panel -->
    </div>
    <!-- fin layout -->
  </div>
  <!-- fin content -->
</div>
<!-- fin container -->
