<app-header></app-header>

<div class="mode-selector-container">
  <div class="icon-menu-fixed">
    <a (click)="navigateTo('perfil')" title="Mi Perfil">
      <i class="fa-solid fa-user"></i>
    </a>
    <a title="Cerrar Sesi칩n">
      <i class="fa-solid fa-right-from-bracket"></i>
    </a>
  </div>

  <div class="avatar-container">
    <app-canvas [animationUrls]="currentAnimationUrls"></app-canvas>
  </div>

  <div class="modes-container">
    <div
      class="mode-card"
      *ngFor="let mode of modes"
      (click)="navigateToMode(mode.route)"
    >
      <div class="top-border"></div>

      <div class="mode-title">
        <h2><img [src]="mode.icon" alt="Icono" />{{ mode.name }}</h2>
        <p>{{ mode.description }}</p>
      </div>

      <!-- Secci칩n de estad칤sticas -->
      <div
        class="mode-stats"
        [ngClass]="{ 'center-content': isNewUserInGuidedMode }"
      >
        <ng-container [ngSwitch]="mode.id">
          <!-- 游늷 Modo Guiado -->
          <ng-container *ngSwitchCase="'guiado'">
            <div *ngIf="isNewUserInGuidedMode; else guidedStats">
              <div class="stat-box empty-guide">
                <p>춰Empieza ahora y descubre nuevas palabras!</p>
                <div class="progressTwo">
                  <div
                    class="progress-bar progress-bar-striped progress-bar-animated"
                    [ngClass]="animatedProgressColor"
                    [style.width.%]="animatedProgress"
                  >
                    <span class="progress-text">{{ animatedProgress }}%</span>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
          <ng-template #freeStat1>
            <!-- Aqu칤, s칩lo si es LIBRE, mostramos estad칤stica 1 -->
            <ng-container *ngIf="mode.id === 'libre'; else defaultStat1">
              <!-- Ejemplo: Palabras exploradas -->
              <p>Has explorado {{ exploredCount }} / {{ totalWords }} palabras en modo libre</p>
            </ng-container>
          </ng-template>
      
          <!-- Si no es guiado ni libre, default: -->
          <ng-template #defaultStat1>
            <p>Lol</p>
          </ng-template>
        </div>
      
        <!-- STAT BOX 2 -->
        <div class="stat-box">
          <ng-container *ngIf="mode.id === 'guiado'; else freeStat2">
            <p>Lecci칩n actual: {{ userLevel }}</p>

            <ng-template #guidedStats>
              <div class="stat-box level-box">
                <p>Est치s en el nivel</p>
                <div class="level-circle">{{ userLevel }}</div>
              </div>

              <div class="stat-box">
                <p>Progreso</p>
                <div class="progress">
                  <div
                    class="progress-bar progress-bar-striped progress-bar-animated"
                    [ngClass]="getProgressColor(progressPercent)"
                    [style.width.%]="progressPercent"
                  >
                    <span class="progress-text">{{ progressPercent }}%</span>
                  </div>
                </div>
              </div>

              <!-- 칔ltima palabra aprendida -->
              <div class="stat-box">
                <p>{{ lastWordLearned }}</p>
              </div>
            </ng-template>
          </ng-container>
      
          <ng-template #freeStat2>
            <ng-container *ngIf="mode.id === 'libre'; else defaultStat2">
              <!-- Ejemplo: Categor칤a m치s explorada -->
              <div *ngIf="mostExploredCategoryName; else noCat">
                <p>Tu categor칤a m치s explorada: {{ mostExploredCategoryName }} ({{ mostExploredCategoryCount }} palabras)</p>
              </div>
              <ng-template #noCat>
                <p>No hay categor칤a m치s explorada</p>
              </ng-template>
            </ng-container>
          </ng-template>
      
          <ng-template #defaultStat2>
            <p>Lol</p>
          </ng-template>
        </div>
      
        <!-- STAT BOX 3 -->
        <div class="stat-box">
          <ng-container *ngIf="mode.id === 'guiado'; else freeStat3">
            <!-- Pr칩xima lecci칩n guiado (ejemplo) -->
            <span *ngIf="nextLevel; else noHayNivel">
              Pr칩xima lecci칩n: {{ nextLevel }}
            </span>
            <ng-template #noHayNivel>
              <span>No hay m치s lecciones disponibles</span>
            </ng-template>

          <!-- 游늷 Modo Libre -->
          <ng-container *ngSwitchCase="'libre'">
            

            <ng-template #freeStats>
              <div class="stat-box">
                <p>
                  Has explorado {{ exploredCount }} / {{ totalWords }} palabras
                </p>
              </div>
            </ng-template>
          </ng-container>
      
          <ng-template #freeStat3>
            <ng-container *ngIf="mode.id === 'libre'; else defaultStat3">
              <!-- Aqu칤 pones lo que quieras del modo libre -->
              <p>Has practicado un total de {{ (tiempoLibreMs / 60000) | number:'1.0-0' }} minutos en Modo Libre</p>
              
              <button (click)="navigateToMode('libre')" class="explore-button">
                Entrar a Modo Libre
              </button>
      
              <div *ngIf="categoriaSugerida">
                <p>Sugerencia: Explora la categor칤a <strong>{{ categoriaSugerida.nombre }}</strong></p>
              </div>
            </ng-container>
          </ng-template>
      
          <ng-template #defaultStat3>
            <p>Lol</p>
          </ng-template>
        </div>

          <!-- 游늷 Modo Examen -->
          <ng-container *ngSwitchCase="'examen'">
            <div class="stat-box">
              <p>Disponible pr칩ximamente...</p>
            </div>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</div>
